<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 12.2.1 (20241206.2353)
 -->
<!-- Title: PinballEventFlow Pages: 1 -->
<svg width="1311pt" height="352pt"
 viewBox="0.00 0.00 1310.50 351.81" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 347.81)">
<title>PinballEventFlow</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-347.81 1306.5,-347.81 1306.5,4 -4,4"/>
<text text-anchor="middle" x="651.25" y="-328.41" font-family="Helvetica,sans-Serif" font-size="12.00">PinballCTL Event &amp; RPC Flow (Pi &lt;&#45;&gt; Bridge &lt;&#45;&gt; ESP)</text>
<!-- UI -->
<g id="node1" class="node">
<title>UI</title>
<path fill="#eef3ff" stroke="#2f3b52" d="M146.5,-112.03C146.5,-112.03 12,-112.03 12,-112.03 6,-112.03 0,-106.03 0,-100.03 0,-100.03 0,-88.03 0,-88.03 0,-82.03 6,-76.03 12,-76.03 12,-76.03 146.5,-76.03 146.5,-76.03 152.5,-76.03 158.5,-82.03 158.5,-88.03 158.5,-88.03 158.5,-100.03 158.5,-100.03 158.5,-106.03 152.5,-112.03 146.5,-112.03"/>
<text text-anchor="middle" x="79.25" y="-95.58" font-family="Helvetica,sans-Serif" font-size="11.00">Pi Web UI / API</text>
<text text-anchor="middle" x="79.25" y="-83.58" font-family="Helvetica,sans-Serif" font-size="11.00">(ESPLink, Rules, Dashboard)</text>
</g>
<!-- Bridge -->
<g id="node2" class="node">
<title>Bridge</title>
<path fill="#eef3ff" stroke="#2f3b52" d="M618.5,-162.03C618.5,-162.03 487.75,-162.03 487.75,-162.03 481.75,-162.03 475.75,-156.03 475.75,-150.03 475.75,-150.03 475.75,-130.03 475.75,-130.03 475.75,-124.03 481.75,-118.03 487.75,-118.03 487.75,-118.03 618.5,-118.03 618.5,-118.03 624.5,-118.03 630.5,-124.03 630.5,-130.03 630.5,-130.03 630.5,-150.03 630.5,-150.03 630.5,-156.03 624.5,-162.03 618.5,-162.03"/>
<text text-anchor="middle" x="553.12" y="-147.58" font-family="Helvetica,sans-Serif" font-size="11.00">Bridge Daemon (Pi)</text>
<text text-anchor="middle" x="553.12" y="-135.58" font-family="Helvetica,sans-Serif" font-size="11.00">Framed JSON over serial</text>
<text text-anchor="middle" x="553.12" y="-123.58" font-family="Helvetica,sans-Serif" font-size="11.00">ReqId match + pending table</text>
</g>
<!-- UI&#45;&gt;Bridge -->
<g id="edge1" class="edge">
<title>UI&#45;&gt;Bridge</title>
<path fill="none" stroke="#3b4d73" d="M108.87,-112.3C127.36,-122.99 152.4,-135.46 176.5,-141.03 273.09,-163.35 387.43,-158.81 464.37,-151.44"/>
<polygon fill="#3b4d73" stroke="#3b4d73" points="464.33,-154.96 473.94,-150.48 463.64,-147.99 464.33,-154.96"/>
<text text-anchor="middle" x="317.12" y="-170.47" font-family="Helvetica,sans-Serif" font-size="10.00">Response&#45;required RPC</text>
<text text-anchor="middle" x="317.12" y="-159.22" font-family="Helvetica,sans-Serif" font-size="10.00">ECHO, GET_INFO, FS_LIST, GET_FS_STATUS, SET_RULES</text>
</g>
<!-- UI&#45;&gt;Bridge -->
<g id="edge2" class="edge">
<title>UI&#45;&gt;Bridge</title>
<path fill="none" stroke="#5a7f2c" d="M158.73,-96.35C252.08,-99.46 402.26,-105.63 457.75,-114.53 459.92,-114.88 462.11,-115.25 464.31,-115.66"/>
<polygon fill="#5a7f2c" stroke="#5a7f2c" points="463.44,-119.05 473.93,-117.58 464.81,-112.19 463.44,-119.05"/>
<text text-anchor="middle" x="317.12" y="-127.53" font-family="Helvetica,sans-Serif" font-size="10.00">Fire&#45;and&#45;forget</text>
<text text-anchor="middle" x="317.12" y="-116.28" font-family="Helvetica,sans-Serif" font-size="10.00">EVENT_FIRE (high&#45;volume)</text>
</g>
<!-- Bridge&#45;&gt;UI -->
<g id="edge8" class="edge">
<title>Bridge&#45;&gt;UI</title>
<path fill="none" stroke="#3b4d73" d="M530.46,-117.7C512.7,-101.1 485.97,-79.8 457.75,-70.53 357.56,-37.62 234.5,-55.25 156.71,-72.96"/>
<polygon fill="#3b4d73" stroke="#3b4d73" points="155.98,-69.54 147.04,-75.22 157.57,-76.35 155.98,-69.54"/>
<text text-anchor="middle" x="317.12" y="-83.53" font-family="Helvetica,sans-Serif" font-size="10.00">reqId correlated responses</text>
<text text-anchor="middle" x="317.12" y="-72.28" font-family="Helvetica,sans-Serif" font-size="10.00">WAIT_REQ / rpc_command</text>
</g>
<!-- ESP -->
<g id="node3" class="node">
<title>ESP</title>
<path fill="#eef3ff" stroke="#2f3b52" d="M1040.25,-213.03C1040.25,-213.03 896.75,-213.03 896.75,-213.03 890.75,-213.03 884.75,-207.03 884.75,-201.03 884.75,-201.03 884.75,-181.03 884.75,-181.03 884.75,-175.03 890.75,-169.03 896.75,-169.03 896.75,-169.03 1040.25,-169.03 1040.25,-169.03 1046.25,-169.03 1052.25,-175.03 1052.25,-181.03 1052.25,-181.03 1052.25,-201.03 1052.25,-201.03 1052.25,-207.03 1046.25,-213.03 1040.25,-213.03"/>
<text text-anchor="middle" x="968.5" y="-198.58" font-family="Helvetica,sans-Serif" font-size="11.00">ESP32 Runtime / Rules Engine</text>
<text text-anchor="middle" x="968.5" y="-186.58" font-family="Helvetica,sans-Serif" font-size="11.00">Real&#45;time switch/coil/LED logic</text>
<text text-anchor="middle" x="968.5" y="-174.58" font-family="Helvetica,sans-Serif" font-size="11.00">Safety gate enforced</text>
</g>
<!-- Bridge&#45;&gt;ESP -->
<g id="edge3" class="edge">
<title>Bridge&#45;&gt;ESP</title>
<path fill="none" stroke="#3b4d73" d="M566.36,-162.12C581.76,-187.36 610.83,-227.34 648.5,-244.03 692.85,-263.67 819.66,-255.66 866.75,-244.03 887.12,-239 907.92,-229.02 925.29,-219.07"/>
<polygon fill="#3b4d73" stroke="#3b4d73" points="926.98,-222.14 933.8,-214.03 923.41,-216.12 926.98,-222.14"/>
<text text-anchor="middle" x="757.62" y="-268.94" font-family="Helvetica,sans-Serif" font-size="10.00">TX framed JSON</text>
<text text-anchor="middle" x="757.62" y="-257.69" font-family="Helvetica,sans-Serif" font-size="10.00">4&#45;byte len + UTF&#45;8 JSON</text>
</g>
<!-- Bus -->
<g id="node4" class="node">
<title>Bus</title>
<path fill="#f4f8ea" stroke="#3e6a2b" d="M1031.25,-39.03C1031.25,-39.03 905.75,-39.03 905.75,-39.03 899.75,-39.03 893.75,-33.03 893.75,-27.03 893.75,-27.03 893.75,-15.03 893.75,-15.03 893.75,-9.03 899.75,-3.03 905.75,-3.03 905.75,-3.03 1031.25,-3.03 1031.25,-3.03 1037.25,-3.03 1043.25,-9.03 1043.25,-15.03 1043.25,-15.03 1043.25,-27.03 1043.25,-27.03 1043.25,-33.03 1037.25,-39.03 1031.25,-39.03"/>
<text text-anchor="middle" x="968.5" y="-22.58" font-family="Helvetica,sans-Serif" font-size="11.00">Pi Event Bus / Handlers</text>
<text text-anchor="middle" x="968.5" y="-10.58" font-family="Helvetica,sans-Serif" font-size="11.00">Scoring, stats, orchestration</text>
</g>
<!-- Bridge&#45;&gt;Bus -->
<g id="edge9" class="edge">
<title>Bridge&#45;&gt;Bus</title>
<path fill="none" stroke="#5a7f2c" d="M566.76,-117.74C582.35,-92.7 611.4,-53.27 648.5,-35.78 688.43,-16.95 802.14,-15.84 882.37,-17.69"/>
<polygon fill="#5a7f2c" stroke="#5a7f2c" points="881.86,-21.18 891.95,-17.93 882.04,-14.18 881.86,-21.18"/>
<text text-anchor="middle" x="757.62" y="-37.53" font-family="Helvetica,sans-Serif" font-size="10.00">Publish EVT/EVENT to local bus</text>
</g>
<!-- Contract -->
<g id="node5" class="node">
<title>Contract</title>
<polygon fill="#fff8dc" stroke="#8b6f1f" points="1296.5,-267.03 1089.25,-267.03 1089.25,-199.03 1302.5,-199.03 1302.5,-261.03 1296.5,-267.03"/>
<polyline fill="none" stroke="#8b6f1f" points="1296.5,-267.03 1296.5,-261.03"/>
<polyline fill="none" stroke="#8b6f1f" points="1302.5,-261.03 1296.5,-261.03"/>
<text text-anchor="middle" x="1195.88" y="-252.58" font-family="Helvetica,sans-Serif" font-size="11.00">Transport Contract:</text>
<text text-anchor="middle" x="1195.88" y="-240.58" font-family="Helvetica,sans-Serif" font-size="11.00">&#45; Frames&#45;only (no line&#45;based commands)</text>
<text text-anchor="middle" x="1195.88" y="-228.58" font-family="Helvetica,sans-Serif" font-size="11.00">&#45; Command payloads are JSON</text>
<text text-anchor="middle" x="1195.88" y="-216.58" font-family="Helvetica,sans-Serif" font-size="11.00">&#45; Backpressure + queueing in bridge</text>
<text text-anchor="middle" x="1195.88" y="-204.58" font-family="Helvetica,sans-Serif" font-size="11.00">&#45; ESP safety and runtime authority</text>
</g>
<!-- Bridge&#45;&gt;Contract -->
<g id="edge11" class="edge">
<title>Bridge&#45;&gt;Contract</title>
<path fill="none" stroke="#8b6f1f" stroke-dasharray="5,2" d="M561.32,-162.38C573.35,-195.54 601.02,-256.57 648.5,-282.03 796.44,-361.34 999.65,-308.22 1111.91,-267.42"/>
</g>
<!-- ESP&#45;&gt;Bridge -->
<g id="edge4" class="edge">
<title>ESP&#45;&gt;Bridge</title>
<path fill="none" stroke="#3b4d73" d="M884.53,-205.98C819.14,-214.66 726.33,-220.03 648.5,-198.03 627.93,-192.21 607.42,-180.51 590.81,-169.13"/>
<polygon fill="#3b4d73" stroke="#3b4d73" points="592.91,-166.33 582.74,-163.39 588.86,-172.04 592.91,-166.33"/>
<text text-anchor="middle" x="757.62" y="-226.53" font-family="Helvetica,sans-Serif" font-size="10.00">RX framed JSON</text>
<text text-anchor="middle" x="757.62" y="-215.28" font-family="Helvetica,sans-Serif" font-size="10.00">all responses/events framed</text>
</g>
<!-- ESP&#45;&gt;Bridge -->
<g id="edge5" class="edge">
<title>ESP&#45;&gt;Bridge</title>
<path fill="none" stroke="#235789" d="M901.65,-168.55C890.13,-165.3 878.17,-162.36 866.75,-160.28 825.19,-152.7 718.93,-146.86 641.81,-143.44"/>
<polygon fill="#235789" stroke="#235789" points="642.31,-139.96 632.17,-143.02 642.01,-146.95 642.31,-139.96"/>
<text text-anchor="middle" x="757.62" y="-184.53" font-family="Helvetica,sans-Serif" font-size="10.00">RPC responses (reqId)</text>
<text text-anchor="middle" x="757.62" y="-173.28" font-family="Helvetica,sans-Serif" font-size="10.00">ECHO, INFO, FS_STATUS, FS_LIST,</text>
<text text-anchor="middle" x="757.62" y="-162.03" font-family="Helvetica,sans-Serif" font-size="10.00">MANIFEST, RULES_STATUS, EVENT_ACK</text>
</g>
<!-- ESP&#45;&gt;Bridge -->
<g id="edge6" class="edge">
<title>ESP&#45;&gt;Bridge</title>
<path fill="none" stroke="#5a7f2c" d="M945.87,-168.84C926.91,-151.1 897.63,-127.59 866.75,-117.53 793.66,-93.7 706.04,-103.02 642.18,-116.16"/>
<polygon fill="#5a7f2c" stroke="#5a7f2c" points="641.47,-112.74 632.42,-118.25 642.93,-119.58 641.47,-112.74"/>
<text text-anchor="middle" x="757.62" y="-130.53" font-family="Helvetica,sans-Serif" font-size="10.00">Async events</text>
<text text-anchor="middle" x="757.62" y="-119.28" font-family="Helvetica,sans-Serif" font-size="10.00">EVT{name,source,seq,tsMs}</text>
</g>
<!-- ESP&#45;&gt;Bridge -->
<g id="edge7" class="edge">
<title>ESP&#45;&gt;Bridge</title>
<path fill="none" stroke="#7a4f01" d="M955.76,-168.68C939.83,-141.05 908.49,-95.4 866.75,-76.53 778.36,-36.57 741.28,-48.22 648.5,-76.53 626.19,-83.34 604.37,-97.38 587.35,-110.54"/>
<polygon fill="#7a4f01" stroke="#7a4f01" points="585.2,-107.77 579.59,-116.75 589.58,-113.23 585.2,-107.77"/>
<text text-anchor="middle" x="757.62" y="-89.53" font-family="Helvetica,sans-Serif" font-size="10.00">Stream control/status</text>
<text text-anchor="middle" x="757.62" y="-78.28" font-family="Helvetica,sans-Serif" font-size="10.00">EVT_STREAM_STATUS, EVT_STREAM_DONE</text>
</g>
<!-- ESP&#45;&gt;Contract -->
<g id="edge12" class="edge">
<title>ESP&#45;&gt;Contract</title>
<path fill="none" stroke="#8b6f1f" stroke-dasharray="5,2" d="M1052.46,-206.49C1064.38,-208.71 1076.79,-211.02 1089.08,-213.31"/>
</g>
<!-- Bus&#45;&gt;UI -->
<g id="edge10" class="edge">
<title>Bus&#45;&gt;UI</title>
<path fill="none" stroke="#3b4d73" d="M893.44,-12.94C751.57,0.25 432.81,18.69 176.5,-48.03 157.35,-53.01 137.43,-61.85 120.7,-70.45"/>
<polygon fill="#3b4d73" stroke="#3b4d73" points="119.27,-67.25 112.08,-75.03 122.55,-73.43 119.27,-67.25"/>
<text text-anchor="middle" x="553.12" y="-16.74" font-family="Helvetica,sans-Serif" font-size="10.00">Optional follow&#45;up actions</text>
<text text-anchor="middle" x="553.12" y="-5.49" font-family="Helvetica,sans-Serif" font-size="10.00">(new commands/events)</text>
</g>
</g>
</svg>
